<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Transaction History - Chicken Road Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    * {
      font-family: 'Poppins', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }
    
    .glass-effect {
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    .btn-gradient {
      background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
      transition: all 0.3s ease;
    }
    
    .btn-gradient:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
    }
    
    .btn-shine {
      position: relative;
      overflow: hidden;
    }
    
    .btn-shine:after {
      content: "";
      position: absolute;
      top: -50%;
      left: -60%;
      width: 40%;
      height: 200%;
      background: rgba(255, 255, 255, 0.13);
      transform: rotate(30deg);
      animation: shine 3s infinite;
    }
    
    @keyframes shine {
      0% { left: -60%; }
      20% { left: 100%; }
      100% { left: 100%; }
    }
    
    .slide-in {
      animation: slideIn 0.5s ease-out;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .type-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .dropdown-enter {
      animation: dropdownEnter 0.2s ease-out;
    }
    
    @keyframes dropdownEnter {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .floating-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
      z-index: 20;
      transition: all 0.3s ease;
    }
    
    .floating-btn:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 15px 30px rgba(59, 130, 246, 0.4);
    }
    
    .particle {
      position: absolute;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 50%;
      pointer-events: none;
    }
    
    .glow {
      animation: glow 2s infinite alternate;
    }
    
    @keyframes glow {
      from {
        box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
      }
      to {
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
      }
    }
    
    .border-gradient {
      border: 2px solid transparent;
      background: linear-gradient(#0f172a, #0f172a) padding-box,
                  linear-gradient(135deg, #3b82f6, #6366f1) border-box;
    }
    
    .hover-scale {
      transition: transform 0.3s ease;
    }
    
    .hover-scale:hover {
      transform: scale(1.02);
    }
    
    .dropdown-item {
      transition: all 0.2s ease;
    }
    
    .dropdown-item:hover {
      background: rgba(59, 130, 246, 0.2);
    }
    
    .table-row {
      transition: all 0.2s ease;
    }
    
    .table-row:hover {
      background: rgba(255, 255, 255, 0.03);
    }
  </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4 overflow-x-hidden">
  <!-- Animated Background Particles -->
  <div id="particles-js" class="fixed inset-0 overflow-hidden pointer-events-none"></div>
  
  <!-- Floating Action Button -->
  <button id="depositFAB" class="floating-btn btn-gradient text-white animate__animated animate__bounceIn">
    <i class="fas fa-plus text-xl"></i>
  </button>

  <div class="glass-effect rounded-3xl shadow-2xl w-full max-w-4xl relative z-10 slide-in overflow-hidden hover-scale">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h2 class="text-2xl font-bold text-left text-white">Transaction History</h2>
          <p class="text-sm text-gray-400 mt-1">View all your deposits, withdrawals, and game transactions</p>
        </div>
        <button onclick="window.location.href='index.php'" class="text-gray-300 hover:text-white text-2xl font-bold transition-colors">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- Filters and Search -->
      <div class="mb-6 flex flex-col sm:flex-row gap-4">
        <!-- Filter Dropdown -->
        <div class="relative flex-1 sm:flex-none sm:w-56">
          <button id="filterDropdown" class="w-full bg-white/5 border border-white/10 text-white px-4 py-2 rounded-xl text-sm font-medium flex items-center justify-between gap-2 hover:bg-white/10 transition-colors">
            <span id="filterText" class="flex items-center gap-2">
              <i class="fas fa-filter"></i> All Transactions
            </span>
            <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
          </button>
          <div id="filterOptions" class="absolute top-full left-0 mt-2 bg-slate-800 border border-slate-700 rounded-xl overflow-hidden hidden z-50 w-full shadow-lg dropdown-enter">
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-type="">
              <i class="fas fa-list text-sm"></i> All Transactions
            </div>
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-type="deposit">
              <i class="fas fa-money-bill-wave text-sm"></i> Deposits
            </div>
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-type="withdrawal">
              <i class="fas fa-wallet text-sm"></i> Withdrawals
            </div>
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-type="bet">
              <i class="fas fa-dice text-sm"></i> Bets
            </div>
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-type="win">
              <i class="fas fa-trophy text-sm"></i> Wins
            </div>
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-type="bonus">
              <i class="fas fa-gift text-sm"></i> Bonuses
            </div>
          </div>
        </div>
        
        <!-- Status Filter -->
        <div class="relative flex-1 sm:flex-none sm:w-56">
          <button id="statusDropdown" class="w-full bg-white/5 border border-white/10 text-white px-4 py-2 rounded-xl text-sm font-medium flex items-center justify-between gap-2 hover:bg-white/10 transition-colors">
            <span id="statusText" class="flex items-center gap-2">
              <i class="fas fa-circle text-gray-400 text-xs"></i> All Statuses
            </span>
            <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
          </button>
          <div id="statusOptions" class="absolute top-full left-0 mt-2 bg-slate-800 border border-slate-700 rounded-xl overflow-hidden hidden z-50 w-full shadow-lg dropdown-enter">
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-status="">
              <i class="fas fa-circle text-gray-400 text-xs"></i> All Statuses
            </div>
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-status="completed">
              <i class="fas fa-circle text-green-400 text-xs"></i> Completed
            </div>
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-status="pending">
              <i class="fas fa-circle text-yellow-400 text-xs"></i> Pending
            </div>
            <div class="dropdown-item px-4 py-3 text-white cursor-pointer flex items-center gap-2" data-status="failed">
              <i class="fas fa-circle text-red-400 text-xs"></i> Failed
            </div>
          </div>
        </div>
        
        <!-- Search Input -->
        <div class="relative flex-1">
          <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
          <input type="text" id="searchInput" placeholder="Search transactions..." 
                 class="w-full pl-10 pr-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:bg-white/10 transition-all">
        </div>
      </div>
      
      <!-- Stats Summary -->
      <div id="statsSummary" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 hidden">
        <div class="bg-white/5 rounded-xl p-4 border border-white/10 hover:bg-white/10 transition-colors">
          <div class="text-xs text-gray-400">Total Deposits</div>
          <div class="text-xl font-bold text-green-400" id="totalDeposits">₹0.00</div>
        </div>
        <div class="bg-white/5 rounded-xl p-4 border border-white/10 hover:bg-white/10 transition-colors">
          <div class="text-xs text-gray-400">Total Withdrawals</div>
          <div class="text-xl font-bold text-red-400" id="totalWithdrawals">₹0.00</div>
        </div>
        <div class="bg-white/5 rounded-xl p-4 border border-white/10 hover:bg-white/10 transition-colors">
          <div class="text-xs text-gray-400">Total Wins</div>
          <div class="text-xl font-bold text-green-400" id="totalWins">₹0.00</div>
        </div>
        <div class="bg-white/5 rounded-xl p-4 border border-white/10 hover:bg-white/10 transition-colors">
          <div class="text-xs text-gray-400">Total Bets</div>
          <div class="text-xl font-bold text-yellow-400" id="totalBets">₹0.00</div>
        </div>
      </div>
      
      <!-- Loading State -->
      <div id="loadingState" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-400 mb-4"></div>
        <div class="text-gray-400">Loading transactions...</div>
      </div>
      
      <!-- Error State -->
      <div id="errorState" class="text-center py-8 hidden">
        <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-500/20 mb-4">
          <i class="fas fa-exclamation-triangle text-red-300"></i>
        </div>
        <div class="text-red-300 text-lg mb-2" id="errorMessage"></div>
        <button onclick="loadTransactions()" class="btn-gradient text-white px-4 py-2 rounded-xl text-sm font-medium">
          <i class="fas fa-sync-alt mr-2"></i> Try Again
        </button>
      </div>
      
      <!-- Transactions Table -->
      <div class="overflow-x-auto scrollbar-hide">
        <table class="min-w-full text-sm">
          <thead>
            <tr class="border-b border-white/10">
              <th class="px-4 py-3 text-left text-white font-semibold">Type</th>
              <th class="px-4 py-3 text-left text-white font-semibold">Amount</th>
              <th class="px-4 py-3 text-left text-white font-semibold">Status</th>
              <th class="px-4 py-3 text-left text-white font-semibold hidden md:table-cell">Details</th>
              <th class="px-4 py-3 text-left text-white font-semibold hidden sm:table-cell">Date/Time</th>
              <th class="px-4 py-3 text-left text-white font-semibold">Action</th>
            </tr>
          </thead>
          <tbody id="transactionsTable" class="divide-y divide-white/10">
          </tbody>
        </table>
      </div>
      
      <!-- Empty State -->
      <div id="emptyState" class="text-center py-12 hidden">
        <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-white/10 mb-4">
          <i class="fas fa-inbox text-gray-400"></i>
        </div>
        <div class="text-gray-300 text-lg mb-2">No transactions found</div>
        <p class="text-gray-400 text-sm max-w-md mx-auto">You don't have any transactions matching your filters. Try adjusting your search criteria.</p>
      </div>
      
      <!-- Pagination -->
      <div id="pagination" class="mt-6 flex flex-col sm:flex-row justify-between items-center gap-4 hidden">
        <div class="text-sm text-gray-400">
          Showing <span id="startItem" class="text-white">0</span> to <span id="endItem" class="text-white">0</span> of <span id="totalItems" class="text-white">0</span> transactions
        </div>
        <div class="flex gap-2">
          <button id="prevBtn" class="bg-white/5 border border-white/10 text-white px-4 py-2 rounded-xl text-sm font-medium hover:bg-white/10 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
            <i class="fas fa-chevron-left mr-1"></i> Previous
          </button>
          <div class="flex items-center">
            <span class="px-3 py-1 text-sm text-white">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
          </div>
          <button id="nextBtn" class="bg-white/5 border border-white/10 text-white px-4 py-2 rounded-xl text-sm font-medium hover:bg-white/10 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
            Next <i class="fas fa-chevron-right ml-1"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Transaction Details Modal -->
  <div id="detailsModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50 hidden animate__animated animate__fadeIn">
    <div class="glass-effect rounded-3xl shadow-2xl w-full max-w-md relative z-10 mx-4 border-gradient">
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-white">Transaction Details</h3>
          <button onclick="closeDetailsModal()" class="text-gray-300 hover:text-white text-2xl font-bold transition-colors">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <div id="modalLoading" class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-400 mb-4"></div>
          <div class="text-gray-400">Loading details...</div>
        </div>
        
        <div id="modalContent" class="hidden">
          <div class="grid grid-cols-2 gap-4 mb-6">
            <div>
              <div class="text-xs text-gray-400">Transaction Type</div>
              <div id="modalType" class="font-medium text-white"></div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Status</div>
              <div id="modalStatus" class="font-medium"></div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Amount</div>
              <div id="modalAmount" class="font-medium"></div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Date & Time</div>
              <div id="modalDate" class="font-medium text-white"></div>
            </div>
          </div>
          
          <div class="mb-4">
            <div class="text-xs text-gray-400 mb-1">Transaction ID</div>
            <div id="modalId" class="font-mono text-sm bg-white/5 p-2 rounded break-all text-white"></div>
          </div>
          
          <div class="mb-4">
            <div class="text-xs text-gray-400 mb-1">Description</div>
            <div id="modalDescription" class="text-sm text-white"></div>
          </div>
          
          <div id="modalExtraInfo" class="hidden">
            <div class="text-xs text-gray-400 mb-1">Additional Information</div>
            <div id="modalExtraContent" class="text-sm text-white bg-white/5 p-3 rounded"></div>
          </div>
        </div>
        
        <div id="modalError" class="hidden text-center py-4">
          <div class="text-red-300 mb-2"><i class="fas fa-exclamation-circle mr-2"></i> Failed to load transaction details</div>
          <button onclick="loadTransactionDetails()" class="btn-gradient text-white px-4 py-2 rounded-xl text-sm font-medium">
            <i class="fas fa-sync-alt mr-2"></i> Try Again
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Login/Register Modal -->
  <div id="authModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50 hidden animate__animated animate__fadeIn">
    <div class="glass-effect rounded-3xl shadow-2xl text-center w-80 max-w-sm border-gradient">
      <div class="p-6">
        <div class="mb-4">
          <div class="w-16 h-16 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-3 glow">
            <i id="authIcon" class="fas fa-user-lock text-3xl text-blue-400"></i>
          </div>
          <div id="authTitle" class="text-2xl font-bold text-white">Login</div>
        </div>
        
        <div class="space-y-4 mb-6">
          <div class="relative">
            <i class="fas fa-user absolute left-3 top-3 text-gray-400"></i>
            <input id="authUsername" type="text" placeholder="Username" 
                   class="w-full px-4 py-3 pl-10 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:bg-white/10 transition-all" />
          </div>
          <div class="relative">
            <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
            <input id="authPassword" type="password" placeholder="Password" 
                   class="w-full px-4 py-3 pl-10 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:bg-white/10 transition-all" />
          </div>
        </div>
        
        <div id="authError" class="text-red-300 text-sm mb-4 hidden"></div>
        
        <button id="authActionBtn" class="w-full btn-gradient text-white px-6 py-3 rounded-xl font-semibold mb-4">
          <i id="authActionIcon" class="fas fa-sign-in-alt mr-2"></i> Login
        </button>
        
        <div class="text-sm text-gray-400">
          <span id="toggleAuthMode" class="text-blue-400 hover:text-blue-300 cursor-pointer transition-colors">
            Don't have an account? Register
          </span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script>
    // Global variables
    let currentPage = 1;
    let currentFilter = '';
    let currentStatus = '';
    let currentSearch = '';
    let totalPages = 1;
    let totalItems = 0;
    let selectedTransactionId = null;
    
    // DOM Content Loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize UI components
      initParticles();
      initDropdowns();
      initSearch();
      initPagination();
      initFloatingButton();
      
      // Check auth and load data
      requireLogin();
    });
    
    // Initialize particles.js
    function initParticles() {
      particlesJS("particles-js", {
        "particles": {
          "number": {
            "value": 80,
            "density": {
              "enable": true,
              "value_area": 800
            }
          },
          "color": {
            "value": "#3b82f6"
          },
          "shape": {
            "type": "circle",
            "stroke": {
              "width": 0,
              "color": "#000000"
            },
            "polygon": {
              "nb_sides": 5
            }
          },
          "opacity": {
            "value": 0.5,
            "random": false,
            "anim": {
              "enable": false,
              "speed": 1,
              "opacity_min": 0.1,
              "sync": false
            }
          },
          "size": {
            "value": 3,
            "random": true,
            "anim": {
              "enable": false,
              "speed": 40,
              "size_min": 0.1,
              "sync": false
            }
          },
          "line_linked": {
            "enable": true,
            "distance": 150,
            "color": "#3b82f6",
            "opacity": 0.2,
            "width": 1
          },
          "move": {
            "enable": true,
            "speed": 2,
            "direction": "none",
            "random": false,
            "straight": false,
            "out_mode": "out",
            "bounce": false,
            "attract": {
              "enable": false,
              "rotateX": 600,
              "rotateY": 1200
            }
          }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": {
            "onhover": {
              "enable": true,
              "mode": "grab"
            },
            "onclick": {
              "enable": true,
              "mode": "push"
            },
            "resize": true
          },
          "modes": {
            "grab": {
              "distance": 140,
              "line_linked": {
                "opacity": 1
              }
            },
            "bubble": {
              "distance": 400,
              "size": 40,
              "duration": 2,
              "opacity": 8,
              "speed": 3
            },
            "repulse": {
              "distance": 200,
              "duration": 0.4
            },
            "push": {
              "particles_nb": 4
            },
            "remove": {
              "particles_nb": 2
            }
          }
        },
        "retina_detect": true
      });
    }
    
    // Initialize floating action button
    function initFloatingButton() {
      const fab = document.getElementById('depositFAB');
      fab.addEventListener('click', function() {
        window.location.href = 'index.php';
      });
    }
    
    // Initialize dropdown menus
    function initDropdowns() {
      // Filter dropdown
      document.getElementById('filterDropdown').addEventListener('click', function(e) {
        e.stopPropagation();
        const options = document.getElementById('filterOptions');
        const icon = this.querySelector('.fa-chevron-down');
        options.classList.toggle('hidden');
        icon.classList.toggle('rotate-180');
        document.getElementById('statusOptions').classList.add('hidden');
        document.getElementById('statusDropdown').querySelector('.fa-chevron-down').classList.remove('rotate-180');
      });
      
      // Status dropdown
      document.getElementById('statusDropdown').addEventListener('click', function(e) {
        e.stopPropagation();
        const options = document.getElementById('statusOptions');
        const icon = this.querySelector('.fa-chevron-down');
        options.classList.toggle('hidden');
        icon.classList.toggle('rotate-180');
        document.getElementById('filterOptions').classList.add('hidden');
        document.getElementById('filterDropdown').querySelector('.fa-chevron-down').classList.remove('rotate-180');
      });
      
      // Close dropdowns when clicking outside
      document.addEventListener('click', function(event) {
        if (!event.target.closest('#filterDropdown') && !event.target.closest('#filterOptions')) {
          document.getElementById('filterOptions').classList.add('hidden');
          document.getElementById('filterDropdown').querySelector('.fa-chevron-down').classList.remove('rotate-180');
        }
        if (!event.target.closest('#statusDropdown') && !event.target.closest('#statusOptions')) {
          document.getElementById('statusOptions').classList.add('hidden');
          document.getElementById('statusDropdown').querySelector('.fa-chevron-down').classList.remove('rotate-180');
        }
      });
      
      // Filter option selection
      document.querySelectorAll('.filter-option').forEach(option => {
        option.addEventListener('click', function() {
          const selectedType = this.dataset.type;
          const filterText = selectedType === '' ? 'All Transactions' : 
            selectedType === 'deposit' ? 'Deposits' :
            selectedType === 'withdrawal' ? 'Withdrawals' :
            selectedType === 'bet' ? 'Bets' :
            selectedType === 'win' ? 'Wins' :
            selectedType === 'bonus' ? 'Bonuses' : 'All Transactions';
          
          document.getElementById('filterText').innerHTML = `<i class="fas fa-filter"></i> ${filterText}`;
          currentFilter = selectedType;
          currentPage = 1;
          loadTransactions();
          document.getElementById('filterOptions').classList.add('hidden');
          document.getElementById('filterDropdown').querySelector('.fa-chevron-down').classList.remove('rotate-180');
        });
      });
      
      // Status option selection
      document.querySelectorAll('.status-option').forEach(option => {
        option.addEventListener('click', function() {
          const selectedStatus = this.dataset.status;
          const statusText = selectedStatus === '' ? 'All Statuses' : 
            selectedStatus === 'completed' ? 'Completed' :
            selectedStatus === 'pending' ? 'Pending' :
            selectedStatus === 'failed' ? 'Failed' : 'All Statuses';
          
          const statusIcon = selectedStatus === '' ? 'fas fa-circle text-gray-400' :
            selectedStatus === 'completed' ? 'fas fa-circle text-green-400' :
            selectedStatus === 'pending' ? 'fas fa-circle text-yellow-400' :
            'fas fa-circle text-red-400';
          
          document.getElementById('statusText').innerHTML = `<i class="${statusIcon} text-xs"></i> ${statusText}`;
          currentStatus = selectedStatus;
          currentPage = 1;
          loadTransactions();
          document.getElementById('statusOptions').classList.add('hidden');
          document.getElementById('statusDropdown').querySelector('.fa-chevron-down').classList.remove('rotate-180');
        });
      });
    }
    
    // Initialize search functionality
    function initSearch() {
      const searchInput = document.getElementById('searchInput');
      let searchTimeout;
      
      searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          currentSearch = this.value.trim();
          currentPage = 1;
          loadTransactions();
        }, 500);
      });
    }
    
    // Initialize pagination controls
    function initPagination() {
      document.getElementById('prevBtn').addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          loadTransactions();
        }
      });
      
      document.getElementById('nextBtn').addEventListener('click', function() {
        if (currentPage < totalPages) {
          currentPage++;
          loadTransactions();
        }
      });
    }
    
    // Auth integration
    function showAuthModal() {
      document.getElementById('authModal').classList.remove('hidden');
      document.getElementById('authError').classList.add('hidden');
    }
    
    function hideAuthModal() {
      document.getElementById('authModal').classList.add('hidden');
    }
    
    function fetchUser() {
      return fetch('api/user.php').then(r => r.json());
    }
    
    function requireLogin() {
      fetchUser().then(data => {
        if (!data.success) showAuthModal();
        else loadTransactions();
      });
    }
    
    // Auth modal logic
    let authMode = 'login';
    document.getElementById('toggleAuthMode').onclick = function() {
      authMode = authMode === 'login' ? 'register' : 'login';
      document.getElementById('authTitle').textContent = authMode === 'login' ? 'Login' : 'Register';
      document.getElementById('authActionBtn').innerHTML = authMode === 'login' 
        ? '<i class="fas fa-sign-in-alt mr-2"></i> Login' 
        : '<i class="fas fa-user-plus mr-2"></i> Register';
      document.getElementById('authIcon').className = authMode === 'login' 
        ? 'fas fa-user-lock text-3xl text-blue-400' 
        : 'fas fa-user-edit text-3xl text-blue-400';
      document.getElementById('toggleAuthMode').textContent = authMode === 'login' 
        ? 'Don\'t have an account? Register' 
        : 'Already have an account? Login';
    };
    
    document.getElementById('authActionBtn').onclick = function() {
      const username = document.getElementById('authUsername').value.trim();
      const password = document.getElementById('authPassword').value;
      const errorDiv = document.getElementById('authError');
      errorDiv.classList.add('hidden');
      
      if (!username || !password) {
        errorDiv.textContent = 'Please fill in all fields';
        errorDiv.classList.remove('hidden');
        return;
      }
      
      let url = authMode === 'login' ? 'api/login.php' : 'api/register.php';
      let body = authMode === 'login' ? { username, password } : { username, email: username, password };
      
      // Show loading state
      const authBtn = document.getElementById('authActionBtn');
      const originalText = authBtn.innerHTML;
      authBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';
      authBtn.disabled = true;
      
      fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          hideAuthModal();
          loadTransactions();
        } else {
          errorDiv.textContent = data.error || 'Authentication failed.';
          errorDiv.classList.remove('hidden');
        }
      })
      .catch(() => {
        errorDiv.textContent = 'Network error.';
        errorDiv.classList.remove('hidden');
      })
      .finally(() => {
        authBtn.innerHTML = originalText;
        authBtn.disabled = false;
      });
    };

    // Load transactions
    function loadTransactions() {
      const loadingState = document.getElementById('loadingState');
      const errorState = document.getElementById('errorState');
      const table = document.getElementById('transactionsTable');
      const emptyState = document.getElementById('emptyState');
      const pagination = document.getElementById('pagination');
      const statsSummary = document.getElementById('statsSummary');
      
      // Show loading state
      loadingState.classList.remove('hidden');
      errorState.classList.add('hidden');
      emptyState.classList.add('hidden');
      pagination.classList.add('hidden');
      statsSummary.classList.add('hidden');
      table.innerHTML = '';
      
      // Build API URL with query parameters
      let url = `api/transactions.php?page=${currentPage}&limit=10`;
      if (currentFilter) url += `&type=${currentFilter}`;
      if (currentStatus) url += `&status=${currentStatus}`;
      if (currentSearch) url += `&search=${encodeURIComponent(currentSearch)}`;
      
      fetch(url)
        .then(r => r.json())
        .then(data => {
          loadingState.classList.add('hidden');
          
          if (data.success) {
            // Show stats summary if available
            if (data.stats) {
              document.getElementById('totalDeposits').textContent = `₹${parseFloat(data.stats.total_deposits || 0).toFixed(2)}`;
              document.getElementById('totalWithdrawals').textContent = `₹${parseFloat(data.stats.total_withdrawals || 0).toFixed(2)}`;
              document.getElementById('totalWins').textContent = `₹${parseFloat(data.stats.total_wins || 0).toFixed(2)}`;
              document.getElementById('totalBets').textContent = `₹${parseFloat(data.stats.total_bets || 0).toFixed(2)}`;
              statsSummary.classList.remove('hidden');
            }
            
            // Display transactions
            if (data.transactions && data.transactions.length > 0) {
              displayTransactions(data.transactions);
              updatePagination(data.pagination);
              pagination.classList.remove('hidden');
            } else {
              emptyState.classList.remove('hidden');
            }
          } else {
            showError(data.error || 'Failed to load transactions');
          }
        })
        .catch(() => {
          loadingState.classList.add('hidden');
          showError('Network error. Please check your connection.');
        });
    }
    
    // Display transactions in the table
    function displayTransactions(transactions) {
      const table = document.getElementById('transactionsTable');
      table.innerHTML = '';
      
      transactions.forEach(tx => {
        const tr = document.createElement('tr');
        tr.className = 'table-row';
        
        // Format date for mobile view
        const date = new Date(tx.created_at);
        const mobileDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const fullDate = date.toLocaleString();
        
        // Get status and type classes
        const statusClass = getStatusClass(tx.status);
        const typeClass = getTypeClass(tx.type);
        const amountClass = parseFloat(tx.amount) >= 0 ? 'text-green-400' : 'text-red-400';
        const amountSign = parseFloat(tx.amount) >= 0 ? '+' : '';
        
        tr.innerHTML = `
          <td class="px-4 py-3">
            <span class="${typeClass}">${getTypeIcon(tx.type)} ${tx.type.charAt(0).toUpperCase() + tx.type.slice(1)}</span>
          </td>
          <td class="px-4 py-3 ${amountClass} font-medium">
            ${amountSign}₹${parseFloat(tx.amount).toFixed(2)}
          </td>
          <td class="px-4 py-3">
            <span class="${statusClass}">${getStatusIcon(tx.status)} ${tx.status.charAt(0).toUpperCase() + tx.status.slice(1)}</span>
          </td>
          <td class="px-4 py-3 hidden md:table-cell text-gray-300 text-sm">
            ${tx.description || '-'}
          </td>
          <td class="px-4 py-3 hidden sm:table-cell text-gray-400 text-xs">
            ${fullDate}
          </td>
          <td class="px-4 py-3 text-right">
            <button onclick="showTransactionDetails('${tx.id}')" class="text-blue-400 hover:text-blue-300 transition-colors">
              <i class="fas fa-eye"></i>
            </button>
          </td>
        `;
        table.appendChild(tr);
      });
    }
    
    // Get CSS class for transaction type
    function getTypeClass(type) {
      switch(type) {
        case 'deposit': return 'type-badge bg-green-500/10 text-green-400 border border-green-500/20';
        case 'withdrawal': return 'type-badge bg-yellow-500/10 text-yellow-400 border border-yellow-500/20';
        case 'bet': return 'type-badge bg-blue-500/10 text-blue-400 border border-blue-500/20';
        case 'win': return 'type-badge bg-green-500/10 text-green-400 border border-green-500/20';
        case 'loss': return 'type-badge bg-red-500/10 text-red-400 border border-red-500/20';
        case 'bonus': return 'type-badge bg-purple-500/10 text-purple-400 border border-purple-500/20';
        case 'referral': return 'type-badge bg-indigo-500/10 text-indigo-400 border border-indigo-500/20';
        default: return 'type-badge bg-gray-500/10 text-gray-400 border border-gray-500/20';
      }
    }
    
    // Get icon for transaction type
    function getTypeIcon(type) {
      switch(type) {
        case 'deposit': return '<i class="fas fa-money-bill-wave mr-1"></i>';
        case 'withdrawal': return '<i class="fas fa-wallet mr-1"></i>';
        case 'bet': return '<i class="fas fa-dice mr-1"></i>';
        case 'win': return '<i class="fas fa-trophy mr-1"></i>';
        case 'loss': return '<i class="fas fa-times-circle mr-1"></i>';
        case 'bonus': return '<i class="fas fa-gift mr-1"></i>';
        case 'referral': return '<i class="fas fa-users mr-1"></i>';
        default: return '<i class="fas fa-exchange-alt mr-1"></i>';
      }
    }
    
    // Get CSS class for transaction status
    function getStatusClass(status) {
      switch(status) {
        case 'completed': return 'status-badge bg-green-500/10 text-green-400 border border-green-500/20';
        case 'pending': return 'status-badge bg-yellow-500/10 text-yellow-400 border border-yellow-500/20';
        case 'failed': return 'status-badge bg-red-500/10 text-red-400 border border-red-500/20';
        case 'cancelled': return 'status-badge bg-gray-500/10 text-gray-400 border border-gray-500/20';
        default: return 'status-badge bg-gray-500/10 text-gray-400 border border-gray-500/20';
      }
    }
    
    // Get icon for transaction status
    function getStatusIcon(status) {
      switch(status) {
        case 'completed': return '<i class="fas fa-check-circle mr-1"></i>';
        case 'pending': return '<i class="fas fa-clock mr-1"></i>';
        case 'failed': return '<i class="fas fa-times-circle mr-1"></i>';
        case 'cancelled': return '<i class="fas fa-ban mr-1"></i>';
        default: return '<i class="fas fa-circle mr-1"></i>';
      }
    }
    
    // Update pagination controls
    function updatePagination(pagination) {
      const paginationDiv = document.getElementById('pagination');
      const currentPageSpan = document.getElementById('currentPage');
      const totalPagesSpan = document.getElementById('totalPages');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const startItemSpan = document.getElementById('startItem');
      const endItemSpan = document.getElementById('endItem');
      const totalItemsSpan = document.getElementById('totalItems');
      
      totalPages = pagination.total_pages;
      currentPage = pagination.current_page;
      totalItems = pagination.total_items;
      const startItem = (currentPage - 1) * pagination.per_page + 1;
      const endItem = Math.min(currentPage * pagination.per_page, totalItems);
      
      currentPageSpan.textContent = currentPage;
      totalPagesSpan.textContent = totalPages;
      startItemSpan.textContent = startItem;
      endItemSpan.textContent = endItem;
      totalItemsSpan.textContent = totalItems;
      
      prevBtn.disabled = !pagination.has_prev;
      nextBtn.disabled = !pagination.has_next;
      
      paginationDiv.classList.remove('hidden');
    }
    
    // Show error message
    function showError(message) {
      const errorState = document.getElementById('errorState');
      const errorMessage = document.getElementById('errorMessage');
      errorMessage.textContent = message;
      errorState.classList.remove('hidden');
    }
    
    // Show transaction details modal
    function showTransactionDetails(transactionId) {
      selectedTransactionId = transactionId;
      const modal = document.getElementById('detailsModal');
      const modalContent = document.getElementById('modalContent');
      const modalLoading = document.getElementById('modalLoading');
      const modalError = document.getElementById('modalError');
      
      modal.classList.remove('hidden');
      modalContent.classList.add('hidden');
      modalLoading.classList.remove('hidden');
      modalError.classList.add('hidden');
      
      loadTransactionDetails();
    }
    
    // Load transaction details
    function loadTransactionDetails() {
      const modalContent = document.getElementById('modalContent');
      const modalLoading = document.getElementById('modalLoading');
      const modalError = document.getElementById('modalError');
      
      fetch(`api/transaction_details.php?id=${selectedTransactionId}`)
        .then(r => r.json())
        .then(data => {
          modalLoading.classList.add('hidden');
          
          if (data.success) {
            const tx = data.transaction;
            const date = new Date(tx.created_at);
            const formattedDate = date.toLocaleString();
            const amountClass = parseFloat(tx.amount) >= 0 ? 'text-green-400' : 'text-red-400';
            const amountSign = parseFloat(tx.amount) >= 0 ? '+' : '';
            
            // Set modal content
            document.getElementById('modalType').innerHTML = `<span class="${getTypeClass(tx.type)}">${getTypeIcon(tx.type)} ${tx.type.charAt(0).toUpperCase() + tx.type.slice(1)}</span>`;
            document.getElementById('modalStatus').innerHTML = `<span class="${getStatusClass(tx.status)}">${getStatusIcon(tx.status)} ${tx.status.charAt(0).toUpperCase() + tx.status.slice(1)}</span>`;
            document.getElementById('modalAmount').innerHTML = `<span class="${amountClass}">${amountSign}₹${parseFloat(tx.amount).toFixed(2)}</span>`;
            document.getElementById('modalDate').textContent = formattedDate;
            document.getElementById('modalId').textContent = tx.id;
            document.getElementById('modalDescription').textContent = tx.description || 'No description provided';
            
            // Show additional info if available
            if (tx.extra_info) {
              document.getElementById('modalExtraContent').textContent = tx.extra_info;
              document.getElementById('modalExtraInfo').classList.remove('hidden');
            } else {
              document.getElementById('modalExtraInfo').classList.add('hidden');
            }
            
            modalContent.classList.remove('hidden');
          } else {
            modalError.classList.remove('hidden');
          }
        })
        .catch(() => {
          modalLoading.classList.add('hidden');
          modalError.classList.remove('hidden');
        });
    }
    
    // Close transaction details modal
    function closeDetailsModal() {
      document.getElementById('detailsModal').classList.add('hidden');
    }
  </script>
</body>
</html>
<!-- Premium GV-Style Bottom Navigation (Large Icons) -->
<style>
  .gv-bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(17, 24, 39, 0.95);
    backdrop-filter: blur(12px);
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 12px 0;
    z-index: 1000;
    box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.6);
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
  }
  .gv-bottom-nav a {
    flex: 1;
    text-align: center;
    font-size: 13px;
    color: #aaa;
    text-decoration: none;
    transition: all 0.3s ease;
  }
  .gv-bottom-nav a .icon-wrap {
    background: rgba(129, 140, 248, 0.08);
    width: 48px;
    height: 48px;
    margin: 0 auto 6px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }
  .gv-bottom-nav a .icon-wrap i {
    font-size: 20px;
    transition: transform 0.3s ease, color 0.3s ease;
  }
  .gv-bottom-nav a:hover .icon-wrap {
    background: rgba(129, 140, 248, 0.2);
    transform: scale(1.1);
  }
  .gv-bottom-nav a.active {
    color: #a78bfa;
    font-weight: 600;
  }
  .gv-bottom-nav a.active .icon-wrap {
    background: #a78bfa20;
    animation: pulseGlow 1.8s infinite;
  }
  .gv-bottom-nav a.active .icon-wrap i {
    color: #a78bfa;
  }

  @keyframes pulseGlow {
    0%, 100% {
      box-shadow: 0 0 5px #a78bfa, 0 0 10px #a78bfa;
    }
    50% {
      box-shadow: 0 0 15px #c084fc, 0 0 25px #c084fc;
    }
  }
</style>

<div class="gv-bottom-nav">
  <a href="index.php" class="<?= basename($_SERVER['PHP_SELF']) == 'index.php' ? 'active' : '' ?>">
    <div class="icon-wrap"><i class="fas fa-home"></i></div>
    Main
  </a>
  <a href="deposit.html" class="<?= basename($_SERVER['PHP_SELF']) == 'deposit.html' ? 'active' : '' ?>">
    <div class="icon-wrap"><i class="fas fa-arrow-down"></i></div>
    Deposit
  </a>
  <a href="refer.php" class="<?= basename($_SERVER['PHP_SELF']) == 'refer.php' ? 'active' : '' ?>">
    <div class="icon-wrap"><i class="fas fa-bullhorn"></i></div>
    Promotion
  </a>
  <a href="withdraw.html" class="<?= basename($_SERVER['PHP_SELF']) == 'withdraw.html' ? 'active' : '' ?>">
    <div class="icon-wrap"><i class="fas fa-arrow-up"></i></div>
    Withdraw
  </a>
  <a href="main.php" class="<?= basename($_SERVER['PHP_SELF']) == 'main.php' ? 'active' : '' ?>">
    <div class="icon-wrap"><i class="fas fa-gamepad"></i></div>
    Games
  </a>
</div>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="assets/js/shared_bottom_nav.js"></script>
